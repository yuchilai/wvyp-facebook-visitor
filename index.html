<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Who Visited Your Profile(Not real, just for fun)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <style>
        .center-box{
            margin: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .btn-slots{
            display: flex;
            justify-content: center;
        }
        .m-b{
            margin-bottom: 10px;
        }
        .m-b-50{
            margin-bottom: 50px;
        }
        .footer-container{
            display: flex;
            justify-content: flex-end;
            padding: 20px;
        }
    </style>
    <script type="text/javascript">
        $(document).ready(function(){
            // Get the current year
            const currentYear = new Date().getFullYear();
            
            // Set the footer text with the current year and your name
            const footerText = `Â© ${currentYear} Yu-Chi Lai. All rights reserved.`;
            $('#footer-text').text(footerText);
            $("button").click(function(){
                $('.analysis').empty();
                var htmlStrCode = $("#floatingTextarea2").val();
                var htmlCode = $('<div>').html(htmlStrCode);
                var scriptTags = htmlCode.find('script[type="application/json"]');
                // Create a table element with the class "table table-hover"
                const table = document.createElement("table");
                table.classList.add("table", "table-hover");
                // Create a header row for the table
                const headerRow = table.insertRow();
                scriptTags.each(function() {
                    var data = JSON.parse($(this).text());
                    if (data?.require?.[0]?.[3]?.[0]?.__bbox?.require?.[0]?.[3]?.[1]?.__bbox?.result?.data?.viewer?.chat_sidebar_contact_rankings !== undefined) {
                        // Adding first num line
                        const h = document.createElement("th");
                        h.innerText = '#';
                        headerRow.appendChild(h)

                        data.require[0][3][0].__bbox.require[0][3][1].__bbox.result.data.viewer.chat_sidebar_contact_rankings.forEach((element, index) => {
                            // Loop through the properties of the first object to create the table headers
                            if(index === 0){
                                for (const property in element) {
                                    if(property !== 'user'){
                                        const headerCell = document.createElement("th");
                                        headerCell.innerText = property;
                                        headerRow.appendChild(headerCell);
                                    }
                                    else{
                                        for (const p in element?.user){
                                            const hc = document.createElement("th");
                                            if(p !== 'story_bucket'){
                                                hc.innerText = p;
                                                headerRow.appendChild(hc);
                                            }
                                        }
                                    }
                                    
                                    
                                }
                            }


                            // Loop through the data array to create the table rows
                            const row = table.insertRow();
                            let fc = row.insertCell();
                            fc.innerText = index+1;
                            for (const property in element) {
                                if(property !== 'user'){
                                    const cell = row.insertCell();
                                    cell.innerText = element[property];
                                }
                                else {
                                    for (const p in element?.user){
                                        if(p === 'story_bucket'){
                                            continue;
                                        }
                                        if(p !== 'profile_picture'){
                                            const c = row.insertCell();
                                            c.innerText  = element?.user[p];
                                        }
                                        else {
                                            // Create a new link element
                                            let myLink = document.createElement('a');

                                            // add id into link
                                            let str = 'https://www.facebook.com/' + element?.buddy_id;
                                            // Set the link href
                                            myLink.setAttribute('href', str);
                                            myLink.setAttribute('target', '_blank');
                                            myLink.setAttribute('rel', 'noopener');

                                            // Create a new image element
                                            let myImage = document.createElement('img');

                                            // Set the image source and alt text
                                            myImage.setAttribute('src', element?.user?.[p]?.uri);
                                            myImage.setAttribute('alt', 'A beautiful image');

                                            // Set the image dimensions
                                            myImage.setAttribute('width', '50');
                                            myImage.setAttribute('height', '50');

                                            // Add the image to the link element
                                            myLink.appendChild(myImage);

                                            // Add the image to an existing element in the HTML document
                                            const c = row.insertCell();
                                            c.appendChild(myLink);
                                        }
                                    }
                                }

                            }

                        }); 
                    }
                    $(".analysis").append(table); 
                });
            });
        });
    </script>
  </head>
  <body>
    <div class="center-box">
        <h1 class="page-title">FACEBOOK: Who visited your profile(NOT REAL! JUST FOR FUN)</h1>
        <div class="form-floating m-b">
            <textarea class="form-control" placeholder="Paste your Facebook page source code" id="floatingTextarea2" style="height: 200px"></textarea>
            <label for="floatingTextarea2">Paste your Facebook page source code</label>
        </div>
        <div class="btn-slots m-b-50">
            <button type="button" class="btn btn-primary">Submit</button>
        </div>
        <div class="analysis">

        </div>
        <div class="mark m-b">
            <ul>
                <li>[206].require[0][3][0].__bbox.require[0][3][1].__bbox.result.data.viewer.chat_sidebar_contact_rankings</li>
                <li>[201].require[0][3][0].__bbox.require[0][3][1].__bbox.result.data.viewer.chat_sidebar_contact_rankings</li>
                <li>require[0][3][0].__bbox.require[0][3][1].__bbox.result.data.viewer.chat_sidebar_contact_rankings</li>
                <li>require[0][3][0].__bbox.require[0][3][1].__bbox.result.data.viewer.chat_sidebar_contact_rankings</li>
                <li>require[0][3][0].__bbox.require[0][3][1].__bbox.result.data.viewer.chat_sidebar_contact_rankings.length</li>
                <li>require[0][3][0].__bbox.require[0][3][1].__bbox.result.data.viewer.chat_sidebar_contact_rankings[i].buddy_id</li>
                <li>require[0][3][0].__bbox.require[0][3][1].__bbox.result.data.viewer.chat_sidebar_contact_rankings[i].user.name</li>
                <li>require[0][3][0].__bbox.require[0][3][1].__bbox.result.data.viewer.chat_sidebar_contact_rankings[i].user.profile_picture.uri</li>
            </ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
  </body>
  <footer>
    <div class="footer-container">
      <p id="footer-text"></p>
    </div>
  </footer>
  
</html>
